(function(a,b){"use strict";var c=a.document,d=a.setTimeout||d,e=a.clearTimeout||e,f=a.setInterval||f,g=a.History=a.History||{};if(typeof g.initHtml4!="undefined")throw new Error("History.js HTML4 Support has already been loaded...");g.initHtml4=function(){if(typeof g.initHtml4.initialized!="undefined")return!1;g.initHtml4.initialized=!0,g.enabled=!0,g.savedHashes=[],g.isLastHash=function(a){var b=g.getHashByIndex(),c;return c=a===b,c},g.saveHash=function(a){return g.isLastHash(a)?!1:(g.savedHashes.push(a),!0)},g.getHashByIndex=function(a){var b=null;return typeof a=="undefined"?b=g.savedHashes[g.savedHashes.length-1]:a<0?b=g.savedHashes[g.savedHashes.length+a]:b=g.savedHashes[a],b},g.discardedHashes={},g.discardedStates={},g.discardState=function(a,b,c){var d=g.getHashByState(a),e;return e={discardedState:a,backState:c,forwardState:b},g.discardedStates[d]=e,!0},g.discardHash=function(a,b,c){var d={discardedHash:a,backState:c,forwardState:b};return g.discardedHashes[a]=d,!0},g.discardedState=function(a){var b=g.getHashByState(a),c;return c=g.discardedStates[b]||!1,c},g.discardedHash=function(a){var b=g.discardedHashes[a]||!1;return b},g.recycleState=function(a){var b=g.getHashByState(a);return g.discardedState(a)&&delete g.discardedStates[b],!0},g.emulated.hashChange&&(g.hashChangeInit=function(){g.checkerFunction=null;var b="",d,e,h,i,j=Boolean(g.getHash());return g.isInternetExplorer()?(d="historyjs-iframe",e=c.createElement("iframe"),e.setAttribute("id",d),e.style.display="none",c.body.appendChild(e),e.contentWindow.document.open(),e.contentWindow.document.close(),h="",i=!1,g.checkerFunction=function(){if(i)return!1;i=!0;var c=g.getHash()||"",d=g.getHash(e.contentWindow.document)||"";return c!==b?(b=c,d!==c&&(h=d=c,e.contentWindow.document.open(),e.contentWindow.document.close(),e.contentWindow.document.location.hash=g.escapeHash(c)),g.Adapter.trigger(a,"hashchange")):d!==h&&(h=d,j&&d===""?g.back():g.setHash(d,!1)),i=!1,!0}):g.checkerFunction=function(){var c=g.getHash()||"";return c!==b&&(b=c,g.Adapter.trigger(a,"hashchange")),!0},g.intervalList.push(f(g.checkerFunction,g.options.hashChangeInterval)),!0},g.Adapter.onDomLoad(g.hashChangeInit)),g.emulated.pushState&&(g.onHashChange=function(b){var c=b&&b.newURL||g.getLocationHref(),d=g.getHashByUrl(c),e=null,f=null,h=null,i;return g.isLastHash(d)?(g.busy(!1),!1):(g.doubleCheckComplete(),g.saveHash(d),d&&g.isTraditionalAnchor(d)?(g.Adapter.trigger(a,"anchorchange"),g.busy(!1),!1):(e=g.extractState(g.getFullUrl(d||g.getLocationHref(),!1),!0),g.isLastSavedState(e)?(g.busy(!1),!1):(f=g.getHashByState(e),i=g.discardedState(e),i?(g.getHashByIndex(-2)===g.getHashByState(i.forwardState)?g.back(!1):g.forward(!1),!1):(g.pushState(e.data,e.title,e.url,!1),!0))))},g.Adapter.bind(a,"hashchange",g.onHashChange),g.pushState=function(b,c,d,e){if(g.getHashByUrl(d))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(e!==!1&&g.busy())return g.pushQueue({scope:g,callback:g.pushState,args:arguments,queue:e}),!1;g.busy(!0);var f=g.createStateObject(b,c,d),h=g.getHashByState(f),i=g.getState(!1),j=g.getHashByState(i),k=g.getHash();return g.storeState(f),g.expectedStateId=f.id,g.recycleState(f),g.setTitle(f),h===j?(g.busy(!1),!1):h!==k&&h!==g.getShortUrl(g.getLocationHref())?(g.setHash(h,!1),!1):(g.saveState(f),g.Adapter.trigger(a,"statechange"),g.busy(!1),!0)},g.replaceState=function(b,c,d,e){if(g.getHashByUrl(d))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(e!==!1&&g.busy())return g.pushQueue({scope:g,callback:g.replaceState,args:arguments,queue:e}),!1;g.busy(!0);var f=g.createStateObject(b,c,d),h=g.getHashByState(f),i=g.getState(!1),j=g.getHashByState(i),k=g.getStateByIndex(-2);return g.discardState(i,f,k),h===j?(g.storeState(f),g.expectedStateId=f.id,g.recycleState(f),g.setTitle(f),g.saveState(f),g.Adapter.trigger(a,"statechange"),g.busy(!1)):g.pushState(f.data,f.title,f.url,!1),!0}),g.emulated.pushState&&g.getHash()&&!g.emulated.hashChange&&g.Adapter.onDomLoad(function(){g.Adapter.trigger(a,"hashchange")})},typeof g.init!="undefined"&&g.init()})(window)